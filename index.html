<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>å°äº”ç«‹é«”åœ–å½¢å¹³å°ï½œç¨œèˆ‡é ‚é»</title>
  <style>
    :root{
      --bg:#0b1220;
      --panel:#121a2b;
      --text:#eaf0ff;
      --muted:#a9b5d6;
      --accent:#66e3ff;
      --danger:#ff6b6b;
      --ok:#55efc4;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, "PingFang TC", "Noto Sans TC", "Microsoft JhengHei", Arial, sans-serif;
      background: radial-gradient(1200px 600px at 20% 0%, #162042 0%, var(--bg) 55%);
      color:var(--text);
    }
    .wrap{
      max-width: 1100px;
      margin: 0 auto;
      padding: 18px;
      display:grid;
      grid-template-columns: 360px 1fr;
      gap:16px;
    }
    @media (max-width: 980px){
      .wrap{grid-template-columns: 1fr}
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 18px;
      box-shadow: 0 16px 40px rgba(0,0,0,0.35);
      overflow:hidden;
    }
    header{
      padding:16px 16px 8px 16px;
    }
    h1{
      margin:0;
      font-size: 18px;
      letter-spacing: .5px;
    }
    .sub{
      margin:6px 0 0 0;
      color:var(--muted);
      font-size: 13px;
      line-height: 1.35;
    }

    .panel{
      padding: 14px 16px 16px 16px;
      background: rgba(0,0,0,0.18);
      border-top: 1px solid rgba(255,255,255,0.10);
    }
    label{
      display:block;
      font-size: 13px;
      color: var(--muted);
      margin: 10px 0 6px;
    }
    select, input{
      width:100%;
      padding: 11px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(10,16,30,0.55);
      color: var(--text);
      outline: none;
      font-size: 15px;
    }
    select:focus, input:focus{
      border-color: rgba(102,227,255,0.65);
      box-shadow: 0 0 0 3px rgba(102,227,255,0.16);
    }
    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .btns{
      display:flex;
      gap: 10px;
      margin-top: 14px;
    }
    button{
      flex:1;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.08);
      color: var(--text);
      font-size: 15px;
      cursor:pointer;
      transition: transform .05s ease, background .2s ease, border-color .2s ease;
    }
    button:hover{
      background: rgba(255,255,255,0.12);
      border-color: rgba(255,255,255,0.22);
    }
    button:active{transform: translateY(1px)}
    .primary{
      background: rgba(102,227,255,0.18);
      border-color: rgba(102,227,255,0.35);
    }
    .primary:hover{
      background: rgba(102,227,255,0.25);
      border-color: rgba(102,227,255,0.55);
    }

    .hint{
      margin-top: 10px;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.4;
    }
    .msg{
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.18);
      font-size: 14px;
      line-height: 1.45;
      display:none;
    }
    .msg.err{
      display:block;
      border-color: rgba(255,107,107,0.35);
      background: rgba(255,107,107,0.10);
      color: #ffd0d0;
    }
    .msg.ok{
      display:block;
      border-color: rgba(85,239,196,0.35);
      background: rgba(85,239,196,0.10);
      color: #d5fff3;
    }

    .viewer{
      position:relative;
      min-height: 520px;
    }
    #nameBanner{
      padding: 14px 16px;
      border-bottom: 1px solid rgba(255,255,255,0.10);
      display:flex;
      align-items:center;
      gap:10px;
    }
    .pill{
      font-size: 12px;
      color: var(--muted);
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.18);
    }
    #shapeName{
      font-size: 18px;
      font-weight: 700;
      letter-spacing: .5px;
    }
    #canvasHost{
      height: calc(520px - 56px);
      min-height: 420px;
    }
    .overlayTip{
      position:absolute;
      right: 12px;
      bottom: 12px;
      font-size: 12px;
      color: var(--muted);
      padding: 7px 10px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.20);
      pointer-events:none;
    }
    .tiny{
      font-size: 12px;
      color: var(--muted);
      padding: 10px 16px 16px;
      border-top: 1px solid rgba(255,255,255,0.10);
      line-height: 1.5;
    }
    code{
      background: rgba(255,255,255,0.08);
      padding: 2px 6px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.12);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <!-- å·¦å´ï¼šæ§åˆ¶é¢æ¿ -->
    <div class="card">
      <header>
        <h1>ğŸ“ å°äº”ç«‹é«”åœ–å½¢å¹³å°ï¼ˆç¨œèˆ‡é ‚é»ï¼‰</h1>
        <p class="sub">
          å…ˆé¸æ“‡ã€Œç¨œæ•¸ã€èˆ‡ã€Œé ‚é»æ•¸ã€ï¼ŒæŒ‰ã€Œç¢ºå®šã€å¾Œæœƒå…ˆé¡¯ç¤ºåç¨±ï¼Œå†ç”Ÿæˆå¯æ—‹è½‰çš„ 3D ç«‹é«”åœ–å½¢ï¼ˆThree.js å³æ™‚ç”Ÿæˆï¼‰ã€‚
        </p>
      </header>

      <div class="panel">
        <div class="row">
          <div>
            <label for="edgesSel">ç¨œæ•¸ï¼ˆEdgeï¼‰</label>
            <select id="edgesSel"></select>
          </div>
          <div>
            <label for="vertsSel">é ‚é»æ•¸ï¼ˆVertexï¼‰</label>
            <select id="vertsSel"></select>
          </div>
        </div>

        <div class="btns">
          <button class="primary" id="confirmBtn">ç¢ºå®š</button>
          <button id="resetBtn">é‡è¨­</button>
        </div>

        <div id="msg" class="msg"></div>

        <div class="hint">
          <div>âœ… å¹³å°æ¶µè“‹ï¼š<b>ä¸‰è‡³äºŒåè§’æŸ±</b>ã€<b>ä¸‰è‡³äºŒåè§’éŒ</b></div>
          <div>ğŸ’¡ ä¾‹å­ï¼š</div>
          <div>ãƒ»ä¸‰è§’æŸ±ï¼šç¨œ=9ï¼Œé ‚é»=6</div>
          <div>ãƒ»äº”è§’éŒï¼šç¨œ=10ï¼Œé ‚é»=6</div>
          <div class="hint" style="margin-top:8px;">
            è¦å¾‹æç¤ºï¼š<br>
            ãƒ»nè§’æŸ±ï¼šé ‚é»=2nï¼Œç¨œ=3n<br>
            ãƒ»nè§’éŒï¼šé ‚é»=n+1ï¼Œç¨œ=2n
          </div>
        </div>
      </div>

      <div class="tiny">
        æ“ä½œï¼šç”¨æ»‘é¼ æ‹–æ‹‰æ—‹è½‰ã€æ»¾è¼ªç¸®æ”¾ã€‚<br>
        å¦‚å‡ºç¾ã€Œä½ çš„è¼¸å…¥ç„¡æ³•ç”Ÿæˆç«‹é«”åœ–å½¢ã€ï¼Œè«‹æŒ‰ã€Œé‡è¨­ã€å†è©¦ã€‚
      </div>
    </div>

    <!-- å³å´ï¼š3D é¡¯ç¤º -->
    <div class="card viewer">
      <div id="nameBanner">
        <div class="pill">åç¨±</div>
        <div id="shapeName">ï¼ˆå°šæœªç”Ÿæˆï¼‰</div>
      </div>
      <div id="canvasHost"></div>
      <div class="overlayTip">æ‹–æ‹‰æ—‹è½‰ï½œæ»¾è¼ªç¸®æ”¾</div>
    </div>
  </div>

  <script type="module">
    import * as THREE from "https://unpkg.com/three@0.160.0/build/three.module.js";
    import { OrbitControls } from "https://unpkg.com/three@0.160.0/examples/jsm/controls/OrbitControls.js";

    // ====== UIï¼šå»ºç«‹é¸é …ï¼ˆç¨œ/é ‚é»ï¼‰ ======
    const edgesSel = document.getElementById("edgesSel");
    const vertsSel = document.getElementById("vertsSel");
    const confirmBtn = document.getElementById("confirmBtn");
    const resetBtn = document.getElementById("resetBtn");
    const msgBox = document.getElementById("msg");
    const shapeNameEl = document.getElementById("shapeName");
    const canvasHost = document.getElementById("canvasHost");

    // ç¨œã€é ‚é»ç¯„åœï¼šå¯¬é¬†ä¸€äº›ï¼Œæ–¹ä¾¿å­¸ç”Ÿè©¦éŒ¯ï¼ˆä½†ä»åˆç†ï¼‰
    // 3..60 è¶³å¤ æ¶µè“‹ n=3..20 çš„è§’æŸ±/è§’éŒ
    function fillSelect(sel, min, max, defaultValue){
      sel.innerHTML = "";
      for(let i=min;i<=max;i++){
        const opt = document.createElement("option");
        opt.value = String(i);
        opt.textContent = String(i);
        sel.appendChild(opt);
      }
      sel.value = String(defaultValue);
    }

    fillSelect(edgesSel, 3, 60, 9);
    fillSelect(vertsSel, 4, 40, 6);

    function setMsg(type, text){
      msgBox.className = "msg " + (type || "");
      msgBox.textContent = text || "";
      msgBox.style.display = text ? "block" : "none";
    }

    // ====== åˆ¤æ–·ï¼šç”±ï¼ˆç¨œ, é ‚é»ï¼‰æ¨å›æ˜¯ nè§’æŸ± / nè§’éŒ ======
    function detectSolid(E, V){
      // nè§’æŸ±ï¼šV=2n, E=3n
      // => Vå¿…é ˆç‚ºå¶æ•¸, ä¸” 2E = 3V
      if (V % 2 === 0){
        const n = V / 2;
        if (n >= 3 && n <= 20 && (2 * E === 3 * V)){
          return { type: "prism", n };
        }
      }

      // nè§’éŒï¼šV=n+1, E=2n => E = 2(V-1)
      {
        const n = V - 1;
        if (n >= 3 && n <= 20 && (E === 2 * n)){
          return { type: "pyramid", n };
        }
      }

      return null;
    }

    // ====== Three.jsï¼šå ´æ™¯/ç›¸æ©Ÿ/æ¸²æŸ“å™¨ ======
    let scene, camera, renderer, controls;
    let currentMesh = null;
    let rafId = null;

    function initThree(){
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0x0b1220);

      const w = canvasHost.clientWidth || 600;
      const h = Math.max(canvasHost.clientHeight || 420, 420);

      camera = new THREE.PerspectiveCamera(45, w / h, 0.1, 200);
      camera.position.set(3.2, 2.4, 3.6);

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
      renderer.setSize(w, h);
      canvasHost.innerHTML = "";
      canvasHost.appendChild(renderer.domElement);

      controls = new OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.dampingFactor = 0.08;

      // å…‰æº
      const amb = new THREE.AmbientLight(0xffffff, 0.55);
      scene.add(amb);

      const dir1 = new THREE.DirectionalLight(0xffffff, 0.85);
      dir1.position.set(4, 6, 3);
      scene.add(dir1);

      const dir2 = new THREE.DirectionalLight(0xffffff, 0.35);
      dir2.position.set(-5, 2, -4);
      scene.add(dir2);

      // åƒè€ƒåœ°é¢ï¼ˆæ·¡æ·¡çš„ï¼‰
      const grid = new THREE.GridHelper(10, 10, 0x22314f, 0x1a2540);
      grid.material.opacity = 0.22;
      grid.material.transparent = true;
      scene.add(grid);

      // ç›£è½ resize
      window.addEventListener("resize", onResize);

      animate();
    }

    function onResize(){
      if (!renderer || !camera) return;
      const w = canvasHost.clientWidth || 600;
      const h = Math.max(canvasHost.clientHeight || 420, 420);
      camera.aspect = w / h;
      camera.updateProjectionMatrix();
      renderer.setSize(w, h);
    }

    function animate(){
      rafId = requestAnimationFrame(animate);
      controls?.update();
      renderer?.render(scene, camera);
    }

    function clearCurrent(){
      if (!scene) return;
      if (currentMesh){
        scene.remove(currentMesh);
        currentMesh.traverse(obj => {
          if (obj.geometry) obj.geometry.dispose();
          if (obj.material){
            if (Array.isArray(obj.material)) obj.material.forEach(m => m.dispose());
            else obj.material.dispose();
          }
        });
        currentMesh = null;
      }
    }

    // ====== å¹¾ä½•ï¼šå»ºç«‹æ­£né‚Šå½¢ï¼ˆ2D é»ï¼‰ ======
    function regularPolygonPoints(n, radius=1){
      const pts = [];
      // è®“ä¸€å€‹é ‚é»æœä¸Šæ›´ç›´è§€
      const start = -Math.PI / 2;
      for (let i=0;i<n;i++){
        const a = start + i * (2*Math.PI/n);
        pts.push(new THREE.Vector2(Math.cos(a)*radius, Math.sin(a)*radius));
      }
      return pts;
    }

    // ====== å»ºç«‹ nè§’æŸ± ======
    function createPrism(n){
      const radius = 1.2;
      const height = 2.2;

      const shape = new THREE.Shape(regularPolygonPoints(n, radius));
      const geo = new THREE.ExtrudeGeometry(shape, {
        depth: height,
        bevelEnabled: false,
        steps: 1
      });

      // Extrude æœƒæ²¿ +Z æ‹‰ä¼¸ï¼ŒæŠŠå®ƒç½®ä¸­ä¸¦è½‰åˆ° Y æ–¹å‘æ¯”è¼ƒåƒã€Œç›´ç«‹ã€
      geo.computeBoundingBox();
      geo.center();

      // æ—‹è½‰ï¼šä»¤ã€Œæ‹‰ä¼¸æ–¹å‘ã€è®Šæˆ Y è»¸ï¼ˆç›´ç«‹ï¼‰
      geo.rotateX(Math.PI / 2);

      const mat = new THREE.MeshStandardMaterial({
        color: 0x66e3ff,
        metalness: 0.15,
        roughness: 0.35
      });

      const mesh = new THREE.Mesh(geo, mat);

      // åŠ é‚Šç·šï¼Œè®“ç¨œæ›´æ¸…æ™°
      const edges = new THREE.EdgesGeometry(geo, 1);
      const line = new THREE.LineSegments(
        edges,
        new THREE.LineBasicMaterial({ color: 0xeaf0ff, transparent:true, opacity:0.85 })
      );
      mesh.add(line);

      return mesh;
    }

    // ====== å»ºç«‹ nè§’éŒ ======
    function createPyramid(n){
      const radius = 1.25;
      const height = 2.4;

      // base points on XZ plane, y = 0
      const pts2 = regularPolygonPoints(n, radius);
      const base = pts2.map(p => new THREE.Vector3(p.x, 0, p.y));
      const apex = new THREE.Vector3(0, height, 0);

      // ä¸‰è§’åŒ–åº•é¢ï¼ˆfan triangulationï¼‰
      // faces: åº•é¢ (0, i, i+1), å´é¢ (i, i+1, apex)
      const positions = [];
      const indices = [];

      // push vertices: base then apex
      base.forEach(v => positions.push(v.x, v.y, v.z));
      positions.push(apex.x, apex.y, apex.z);
      const apexIndex = n;

      // åº•é¢ï¼ˆç‚ºäº†é¡¯ç¤ºå¤–å½¢ï¼Œä¸ä¸€å®šè¦åšï¼Œä½†åšå’—æœƒæ›´å®Œæ•´ï¼‰
      for (let i=1; i<n-1; i++){
        indices.push(0, i+1, i); // æ³¨æ„æ–¹å‘ï¼Œä»¤æ³•ç·šå‘ä¸‹/ä¸Šå½±éŸ¿ä¸å¤§ï¼ˆæœ‰é›™é¢å¯è¦‹ï¼‰
      }

      // å´é¢
      for (let i=0; i<n; i++){
        const j = (i+1) % n;
        indices.push(i, j, apexIndex);
      }

      const geo = new THREE.BufferGeometry();
      geo.setAttribute("position", new THREE.Float32BufferAttribute(positions, 3));
      geo.setIndex(indices);
      geo.computeVertexNormals();
      geo.computeBoundingBox();
      geo.center();

      const mat = new THREE.MeshStandardMaterial({
        color: 0x55efc4,
        metalness: 0.12,
        roughness: 0.38,
        side: THREE.DoubleSide
      });

      const mesh = new THREE.Mesh(geo, mat);

      const edges = new THREE.EdgesGeometry(geo, 1);
      const line = new THREE.LineSegments(
        edges,
        new THREE.LineBasicMaterial({ color: 0xeaf0ff, transparent:true, opacity:0.85 })
      );
      mesh.add(line);

      return mesh;
    }

    // ====== ç”Ÿæˆæµç¨‹ï¼šå…ˆé¡¯ç¤ºåç¨±ï¼Œå†é¡¯ç¤º 3D ======
    function generateFromInputs(){
      const E = Number(edgesSel.value);
      const V = Number(vertsSel.value);

      const detected = detectSolid(E, V);

      if (!detected){
        shapeNameEl.textContent = "ï¼ˆç„¡æ³•ç”Ÿæˆï¼‰";
        clearCurrent();
        setMsg("err", "ä½ çš„è¼¸å…¥ç„¡æ³•ç”Ÿæˆç«‹é«”åœ–å½¢ã€‚è«‹æŒ‰ã€Œé‡è¨­ã€æˆ–æ›´æ”¹ç¨œæ•¸/é ‚é»æ•¸å†è©¦ã€‚");
        return;
      }

      setMsg("", "");
      const name = detected.type === "prism" ? `${detected.n}è§’æŸ±` : `${detected.n}è§’éŒ`;
      shapeNameEl.textContent = name;

      // å…ˆé¡¯ç¤ºåç¨±ï¼Œç¨å¾Œå†ç”Ÿæˆ 3Dï¼ˆç¬¦åˆä½ è¦æ±‚ï¼šå…ˆåç¨±ã€å† 3Dï¼‰
      clearCurrent();

      setTimeout(() => {
        const mesh = detected.type === "prism"
          ? createPrism(detected.n)
          : createPyramid(detected.n);

        currentMesh = mesh;
        scene.add(mesh);

        // ç›¸æ©Ÿ/æ§åˆ¶å™¨ç¨å¾®èª¿æ•´è§€æ„Ÿ
        controls.target.set(0, 0.2, 0);
        controls.update();

        setMsg("ok", `å·²ç”Ÿæˆï¼š${name}ï¼ˆç¨œ=${E}ï¼Œé ‚é»=${V}ï¼‰`);
      }, 450);
    }

    function resetAll(){
      // é‡è¨­åˆ°ä¸€å€‹ã€Œä¸‰è§’æŸ±ã€ä¾‹å­
      edgesSel.value = "9";
      vertsSel.value = "6";
      shapeNameEl.textContent = "ï¼ˆå°šæœªç”Ÿæˆï¼‰";
      setMsg("", "");
      clearCurrent();
    }

    // ====== ç¶å®šäº‹ä»¶ ======
    confirmBtn.addEventListener("click", generateFromInputs);
    resetBtn.addEventListener("click", resetAll);

    // Enter éµä¹Ÿå¯ç¢ºå®š
    window.addEventListener("keydown", (e) => {
      if (e.key === "Enter") generateFromInputs();
    });

    // åˆå§‹åŒ– Three
    initThree();
  </script>
</body>
</html>
