<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>å°äº”ç«‹é«”åœ–å½¢å¹³å°ï½œç¨œèˆ‡é ‚é»</title>

  <style>
    :root{
      --bg:#0b1220;
      --text:#eaf0ff;
      --muted:#a9b5d6;
      --danger:#ff6b6b;
      --ok:#55efc4;
      --line: rgba(255,255,255,0.12);
      --panel: rgba(0,0,0,0.18);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, "PingFang TC", "Noto Sans TC", "Microsoft JhengHei", Arial, sans-serif;
      background: radial-gradient(1200px 600px at 20% 0%, #162042 0%, var(--bg) 55%);
      color:var(--text);
    }
    .wrap{
      max-width: 1100px;
      margin: 0 auto;
      padding: 18px;
      display:grid;
      grid-template-columns: 360px 1fr;
      gap:16px;
    }
    @media (max-width: 980px){ .wrap{grid-template-columns: 1fr} }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
      border: 1px solid var(--line);
      border-radius: 18px;
      box-shadow: 0 16px 40px rgba(0,0,0,0.35);
      overflow:hidden;
    }
    header{ padding:16px 16px 8px 16px; }
    h1{ margin:0; font-size:18px; letter-spacing:.5px; }
    .sub{ margin:6px 0 0 0; color:var(--muted); font-size:13px; line-height:1.35; }

    .panel{
      padding: 14px 16px 16px 16px;
      background: var(--panel);
      border-top: 1px solid rgba(255,255,255,0.10);
    }
    label{ display:block; font-size:13px; color:var(--muted); margin:10px 0 6px; }
    select{
      width:100%;
      padding: 11px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(10,16,30,0.55);
      color: var(--text);
      outline: none;
      font-size: 15px;
    }
    .row{ display:grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .btns{ display:flex; gap:10px; margin-top:14px; }
    button{
      flex:1;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.08);
      color: var(--text);
      font-size: 15px;
      cursor:pointer;
    }
    button:hover{ background: rgba(255,255,255,0.12); }
    .primary{
      background: rgba(102,227,255,0.18);
      border-color: rgba(102,227,255,0.35);
    }

    .msg{
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.18);
      font-size: 14px;
      line-height: 1.45;
      display:none;
      white-space: pre-line;
    }
    .msg.err{
      display:block;
      border-color: rgba(255,107,107,0.35);
      background: rgba(255,107,107,0.10);
      color: #ffd0d0;
    }
    .msg.ok{
      display:block;
      border-color: rgba(85,239,196,0.35);
      background: rgba(85,239,196,0.10);
      color: #d5fff3;
    }
    .msg.info{
      display:block;
      border-color: rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.06);
      color: var(--muted);
    }

    .viewer{ position:relative; min-height: 520px; }
    #nameBanner{
      padding: 14px 16px;
      border-bottom: 1px solid rgba(255,255,255,0.10);
      display:flex;
      align-items:center;
      gap:10px;
    }
    .pill{
      font-size: 12px;
      color: var(--muted);
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.18);
    }
    #shapeName{ font-size: 18px; font-weight: 700; letter-spacing: .5px; }
    #canvasHost{ height: calc(520px - 56px); min-height: 420px; }
    .overlayTip{
      position:absolute; right: 12px; bottom: 12px;
      font-size: 12px; color: var(--muted);
      padding: 7px 10px; border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.20);
      pointer-events:none;
    }
    .tiny{
      font-size: 12px;
      color: var(--muted);
      padding: 10px 16px 16px;
      border-top: 1px solid rgba(255,255,255,0.10);
      line-height: 1.5;
    }
  </style>

  <!-- âœ… ç”¨ jsDelivrï¼ˆé€šå¸¸æ¯” unpkg æ›´å°‘è¢«æ“‹ï¼‰ -->
  <script type="importmap">
    {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
        "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
      }
    }
  </script>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <header>
        <h1>ğŸ“ å°äº”ç«‹é«”åœ–å½¢å¹³å°ï¼ˆç¨œèˆ‡é ‚é»ï¼‰</h1>
        <p class="sub">
          å…ˆé¸æ“‡ã€Œç¨œæ•¸ã€èˆ‡ã€Œé ‚é»æ•¸ã€ï¼ŒæŒ‰ã€Œç¢ºå®šã€å¾Œå…ˆé¡¯ç¤ºåç¨±ï¼ˆä¸­åœ‹æ•¸ç›®å­—ï¼‰ï¼Œå†ç”Ÿæˆå¯æ—‹è½‰çš„ 3D ç«‹é«”åœ–å½¢ã€‚
        </p>
      </header>

      <div class="panel">
        <div class="row">
          <div>
            <label for="edgesSel">ç¨œæ•¸ï¼ˆ6â€“60ï¼‰</label>
            <select id="edgesSel"></select>
          </div>
          <div>
            <label for="vertsSel">é ‚é»æ•¸ï¼ˆ4â€“40ï¼‰</label>
            <select id="vertsSel"></select>
          </div>
        </div>

        <div class="btns">
          <button class="primary" id="confirmBtn">ç¢ºå®š</button>
          <button id="resetBtn">é‡è¨­</button>
        </div>

        <div id="msg" class="msg info">æ­£åœ¨è¼‰å…¥ 3D æ¨¡çµ„â€¦</div>

        <div class="tiny" style="border-top:none; padding:10px 0 0;">
          è¦å¾‹æç¤ºï¼š<br>
          ãƒ»nè§’æŸ±ï¼šç¨œ=3nï¼Œé ‚é»=2nï¼Œï¼ˆn=3â€“20ï¼‰<br>
          ãƒ»nè§’éŒï¼šç¨œ=2nï¼Œé ‚é»=n+1ï¼ˆn=3â€“20ï¼‰
        </div>
      </div>

      <div class="tiny">
        æ“ä½œï¼šæ‹–æ‹‰æ—‹è½‰ï½œæ»¾è¼ªç¸®æ”¾ã€‚<br>
      </div>
    </div>

    <div class="card viewer">
      <div id="nameBanner">
        <div class="pill">åç¨±</div>
        <div id="shapeName">ï¼ˆå°šæœªç”Ÿæˆï¼‰</div>
      </div>
      <div id="canvasHost"></div>
      <div class="overlayTip">æ‹–æ‹‰æ—‹è½‰ï½œæ»¾è¼ªç¸®æ”¾</div>
    </div>
  </div>

  <!-- âœ… å…ˆå¡«å¥½ä¸‹æ‹‰é¸å–®ï¼ˆå””ä¾è³´ three.jsï¼‰ -->
  <script>
    const edgesSel = document.getElementById("edgesSel");
    const vertsSel = document.getElementById("vertsSel");
    const confirmBtn = document.getElementById("confirmBtn");
    const resetBtn = document.getElementById("resetBtn");
    const msgBox = document.getElementById("msg");
    const shapeNameEl = document.getElementById("shapeName");

    function fillSelect(select, min, max, defaultValue){
      select.innerHTML = "";
      for(let i=min; i<=max; i++){
        const opt = document.createElement("option");
        opt.value = String(i);
        opt.textContent = String(i);
        select.appendChild(opt);
      }
      select.value = String(defaultValue);
    }

    // âœ… ä½ è¦æ±‚ï¼šç¨œ 6â€“60ï¼›é ‚é» 4â€“40
    fillSelect(edgesSel, 6, 60, 9);
    fillSelect(vertsSel, 4, 40, 6);

    function setMsg(type, text){
      msgBox.className = "msg " + (type || "");
      msgBox.textContent = text || "";
      msgBox.style.display = text ? "block" : "none";
    }

    function toChineseNumber(n){
      // åªéœ€è¦ 3â€“20ï¼ˆè§’æŸ±/è§’éŒï¼‰
      const map = {
        0:"é›¶",1:"ä¸€",2:"äºŒ",3:"ä¸‰",4:"å››",5:"äº”",6:"å…­",7:"ä¸ƒ",8:"å…«",9:"ä¹",10:"å",
        11:"åä¸€",12:"åäºŒ",13:"åä¸‰",14:"åå››",15:"åäº”",16:"åå…­",17:"åä¸ƒ",18:"åå…«",19:"åä¹",20:"äºŒå"
      };
      return map[n] ?? String(n);
    }

    function detectSolid(E, V){
      // nè§’æŸ±ï¼šV=2n, E=3n => Vå¶æ•¸ & 2E=3V
      if (V % 2 === 0){
        const n = V / 2;
        if (n >= 3 && n <= 20 && (2 * E === 3 * V)) return { type:"prism", n };
      }
      // nè§’éŒï¼šV=n+1, E=2n
      const n2 = V - 1;
      if (n2 >= 3 && n2 <= 20 && (E === 2 * n2)) return { type:"pyramid", n:n2 };
      return null;
    }

    function updateNameOnly(){
      const E = Number(edgesSel.value);
      const V = Number(vertsSel.value);
      const d = detectSolid(E, V);
      if (!d){
        shapeNameEl.textContent = "ï¼ˆç„¡æ³•ç”Ÿæˆï¼‰";
        return null;
      }
      const nZh = toChineseNumber(d.n);
      const name = d.type === "prism" ? `${nZh}è§’æŸ±` : `${nZh}è§’éŒ`;
      shapeNameEl.textContent = name;
      return { ...d, name };
    }

    resetBtn.addEventListener("click", () => {
      edgesSel.value = "9";
      vertsSel.value = "6";
      shapeNameEl.textContent = "ï¼ˆå°šæœªç”Ÿæˆï¼‰";
      setMsg("info", "æ­£åœ¨è¼‰å…¥ 3D æ¨¡çµ„â€¦");
      window.__clear3D?.();
    });

    // å¦‚æœ 3D æœªreadyï¼Œå…ˆåªé¡¯ç¤ºä¸­æ–‡åç¨± + æç¤º
    confirmBtn.addEventListener("click", () => {
      const info = updateNameOnly();
      if (!info){
        window.__clear3D?.();
        setMsg("err", "ä½ çš„è¼¸å…¥ç„¡æ³•ç”Ÿæˆç«‹é«”åœ–å½¢ã€‚è«‹æŒ‰ã€Œé‡è¨­ã€æˆ–æ›´æ”¹ç¨œæ•¸/é ‚é»æ•¸å†è©¦ã€‚");
        return;
      }
      if (!window.__generate3D){
        setMsg("err",
          "æœªèƒ½è¼‰å…¥ 3D æ¨¡çµ„ã€‚\n" +
          "è«‹ç”¨ GitHub Pages é–‹å•Ÿï¼ˆå””å¥½ç”¨ file:// é›™æ“Šï¼‰ï¼Œæˆ–æª¢æŸ¥å­¸æ ¡ç¶²çµ¡æ˜¯å¦å°é– cdn.jsdelivr.netã€‚"
        );
        return;
      }
      window.__generate3D(); // äº¤ä¿¾ 3D module ç”Ÿæˆ
    });

    window.addEventListener("keydown", (e) => {
      if (e.key === "Enter") confirmBtn.click();
    });

    // è®Šæ›´é¸é …æ™‚ï¼Œå…ˆå³æ™‚æ›´æ–°åç¨±ï¼ˆæ›´åƒæ•™å­¸å·¥å…·ï¼‰
    edgesSel.addEventListener("change", updateNameOnly);
    vertsSel.addEventListener("change", updateNameOnly);
  </script>

  <!-- âœ… Three.jsï¼ˆæˆåŠŸè¼‰å…¥å°±ä¸€å®šæœƒå‡º 3Dï¼‰ -->
  <script type="module">
    import * as THREE from "three";
    import { OrbitControls } from "three/addons/controls/OrbitControls.js";

    const edgesSel = document.getElementById("edgesSel");
    const vertsSel = document.getElementById("vertsSel");
    const msgBox = document.getElementById("msg");
    const shapeNameEl = document.getElementById("shapeName");
    const canvasHost = document.getElementById("canvasHost");

    function setMsg(type, text){
      msgBox.className = "msg " + (type || "");
      msgBox.textContent = text || "";
      msgBox.style.display = text ? "block" : "none";
    }

    function toChineseNumber(n){
      const map = {
        0:"é›¶",1:"ä¸€",2:"äºŒ",3:"ä¸‰",4:"å››",5:"äº”",6:"å…­",7:"ä¸ƒ",8:"å…«",9:"ä¹",10:"å",
        11:"åä¸€",12:"åäºŒ",13:"åä¸‰",14:"åå››",15:"åäº”",16:"åå…­",17:"åä¸ƒ",18:"åå…«",19:"åä¹",20:"äºŒå"
      };
      return map[n] ?? String(n);
    }

    function detectSolid(E, V){
      if (V % 2 === 0){
        const n = V / 2;
        if (n >= 3 && n <= 20 && (2 * E === 3 * V)) return { type:"prism", n };
      }
      const n2 = V - 1;
      if (n2 >= 3 && n2 <= 20 && (E === 2 * n2)) return { type:"pyramid", n:n2 };
      return null;
    }

    // ===== Three.js åˆå§‹åŒ– =====
    let scene, camera, renderer, controls;
    let currentMesh = null;

    function initThree(){
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0x0b1220);

      const w = canvasHost.clientWidth || 600;
      const h = Math.max(canvasHost.clientHeight || 420, 420);

      camera = new THREE.PerspectiveCamera(45, w / h, 0.1, 200);
      camera.position.set(3.2, 2.4, 3.6);

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
      renderer.setSize(w, h);
      canvasHost.innerHTML = "";
      canvasHost.appendChild(renderer.domElement);

      controls = new OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.dampingFactor = 0.08;

      // å…‰æº
      scene.add(new THREE.AmbientLight(0xffffff, 0.55));
      const dir1 = new THREE.DirectionalLight(0xffffff, 0.85);
      dir1.position.set(4, 6, 3);
      scene.add(dir1);
      const dir2 = new THREE.DirectionalLight(0xffffff, 0.35);
      dir2.position.set(-5, 2, -4);
      scene.add(dir2);

      // åƒè€ƒåœ°é¢
      const grid = new THREE.GridHelper(10, 10, 0x22314f, 0x1a2540);
      grid.material.opacity = 0.22;
      grid.material.transparent = true;
      scene.add(grid);

      window.addEventListener("resize", () => {
        const w2 = canvasHost.clientWidth || 600;
        const h2 = Math.max(canvasHost.clientHeight || 420, 420);
        camera.aspect = w2 / h2;
        camera.updateProjectionMatrix();
        renderer.setSize(w2, h2);
      });

      (function animate(){
        requestAnimationFrame(animate);
        controls.update();
        renderer.render(scene, camera);
      })();
    }

    function clearCurrent(){
      if (!scene) return;
      if (!currentMesh) return;

      scene.remove(currentMesh);
      currentMesh.traverse(obj => {
        if (obj.geometry) obj.geometry.dispose();
        if (obj.material){
          if (Array.isArray(obj.material)) obj.material.forEach(m => m.dispose());
          else obj.material.dispose();
        }
      });
      currentMesh = null;
    }

    function regularPolygonPoints(n, radius=1){
      const pts = [];
      const start = -Math.PI / 2;
      for (let i=0;i<n;i++){
        const a = start + i * (2*Math.PI/n);
        pts.push(new THREE.Vector2(Math.cos(a)*radius, Math.sin(a)*radius));
      }
      return pts;
    }

    function createPrism(n){
      const radius = 1.2;
      const height = 2.2;

      const shape = new THREE.Shape(regularPolygonPoints(n, radius));
      const geo = new THREE.ExtrudeGeometry(shape, {
        depth: height,
        bevelEnabled: false,
        steps: 1
      });
      geo.center();
      geo.rotateX(Math.PI / 2);

      const mat = new THREE.MeshStandardMaterial({
        color: 0x66e3ff,
        metalness: 0.15,
        roughness: 0.35
      });

      const mesh = new THREE.Mesh(geo, mat);

      const edges = new THREE.EdgesGeometry(geo, 1);
      const line = new THREE.LineSegments(
        edges,
        new THREE.LineBasicMaterial({ color: 0xeaf0ff, transparent:true, opacity:0.85 })
      );
      mesh.add(line);

      return mesh;
    }

    function createPyramid(n){
      const radius = 1.25;
      const height = 2.4;

      const pts2 = regularPolygonPoints(n, radius);
      const base = pts2.map(p => new THREE.Vector3(p.x, 0, p.y));
      const apex = new THREE.Vector3(0, height, 0);

      const positions = [];
      const indices = [];

      base.forEach(v => positions.push(v.x, v.y, v.z));
      positions.push(apex.x, apex.y, apex.z);
      const apexIndex = n;

      // åº•é¢ï¼ˆä¸‰è§’åŒ–ï¼‰
      for (let i=1; i<n-1; i++){
        indices.push(0, i+1, i);
      }
      // å´é¢
      for (let i=0; i<n; i++){
        const j = (i+1) % n;
        indices.push(i, j, apexIndex);
      }

      const geo = new THREE.BufferGeometry();
      geo.setAttribute("position", new THREE.Float32BufferAttribute(positions, 3));
      geo.setIndex(indices);
      geo.computeVertexNormals();
      geo.center();

      const mat = new THREE.MeshStandardMaterial({
        color: 0x55efc4,
        metalness: 0.12,
        roughness: 0.38,
        side: THREE.DoubleSide
      });

      const mesh = new THREE.Mesh(geo, mat);

      const edges = new THREE.EdgesGeometry(geo, 1);
      const line = new THREE.LineSegments(
        edges,
        new THREE.LineBasicMaterial({ color: 0xeaf0ff, transparent:true, opacity:0.85 })
      );
      mesh.add(line);

      return mesh;
    }

    function generateFromInputs(){
      const E = Number(edgesSel.value);
      const V = Number(vertsSel.value);
      const d = detectSolid(E, V);

      if (!d){
        shapeNameEl.textContent = "ï¼ˆç„¡æ³•ç”Ÿæˆï¼‰";
        clearCurrent();
        setMsg("err", "ä½ çš„è¼¸å…¥ç„¡æ³•ç”Ÿæˆç«‹é«”åœ–å½¢ã€‚è«‹æŒ‰ã€Œé‡è¨­ã€æˆ–æ›´æ”¹ç¨œæ•¸/é ‚é»æ•¸å†è©¦ã€‚");
        return;
      }

      const nZh = toChineseNumber(d.n);
      const name = d.type === "prism" ? `${nZh}è§’æŸ±` : `${nZh}è§’éŒ`;
      shapeNameEl.textContent = name;

      clearCurrent();
      setMsg("", "");

      // å…ˆé¡¯ç¤ºåç¨±ï¼Œå†ç”Ÿæˆ 3D
      setTimeout(() => {
        const mesh = d.type === "prism" ? createPrism(d.n) : createPyramid(d.n);
        currentMesh = mesh;
        scene.add(mesh);
        controls.target.set(0, 0.2, 0);
        controls.update();
        setMsg("ok", `å·²ç”Ÿæˆï¼š${name}ï¼ˆç¨œ=${E}ï¼Œé ‚é»=${V}ï¼‰`);
      }, 450);
    }

    // å°å¤–æä¾›
    window.__generate3D = generateFromInputs;
    window.__clear3D = clearCurrent;

    initThree();
    setMsg("ok", "3D æ¨¡çµ„è¼‰å…¥æˆåŠŸã€‚ä½ å¯ä»¥æŒ‰ã€Œç¢ºå®šã€ç”Ÿæˆç«‹é«”åœ–å½¢ã€‚");
  </script>
</body>
</html>
